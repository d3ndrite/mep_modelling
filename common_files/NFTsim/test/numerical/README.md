# Testing Consistency of Numerical Output

This directory(`nftsim/test/numerical/`) contains configuration (`.conf`) files
that are intended to be used as a check of consistent behaviour following code
modifications. As such, if you intend to add a `.conf` file to this set, they
are expected to each run in under a few seconds and produce less than 500 kB of
output.

**NOTE: For exact reproducibility on older gcc (School of Physics, RHEL 6 and 7),
  you MUST first rebuild `nftsim` using:**
 ```
 make clean
 make debug
 ```

The expected output from these configuration files is stored in the directory
`nftsim/test/numerical/data/` and preserved as part of the `nftsim` repository.

The bash script `nf_numerical` (which can be found in the `nftsim/` directory)
exists to check the current output generated by `nftsim` against these stored
results. So, to check that any modifications that you have made to the code
have not inadvertently altered its functionality, run:
```
nf_numerical --check <config_file_name>
```
for example:
```
nf_numerical --check 'e-erps'
```

To check the full set of numerical-test configuration files, run:
```
nf_numerical --check 'all'
```

When a `--check` reveals a difference from the expected output the temporary
file used for the check is not removed, this makes it easy to look at the
difference in more detail. Once you no longer need these temporary files you
can clean them up by running:
```
nf_numerical --clean
```

If a change to the code is made that **intentionally** modifies one of these
files then the output file should be regenerated by running:
```
nf_numerical --regenerate <config_file_name>
```

and the updated output file should be committed as part of the pull request
making the change.
